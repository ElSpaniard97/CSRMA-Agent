<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Infrastructure Troubleshooting Agent</title>
  <meta name="description" content="Diagnostics-first AI troubleshooting tool for networking, servers, scripts, and hardware. Restricted access - Login required." />
  <meta name="robots" content="noindex, nofollow" />
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”§</text></svg>" />
  
  <link rel="stylesheet" href="./main.css?v=5" />
</head>

<body>
  <!-- LOGIN SCREEN -->
  <div id="loginScreen" class="centerPage">
    <div class="loginShell">
      <div class="card">
        <div class="brand" style="margin-bottom:10px;">
          <div class="logo" aria-label="AI Agent Logo">AI</div>
          <div>
            <h1 style="margin:0;">Sign in</h1>
            <p style="margin:6px 0 0;">Access is restricted. Authenticate to use the troubleshooting agent.</p>
          </div>
        </div>

        <form id="loginForm" style="display:grid; gap:10px; margin-top:14px;">
          <input
            id="loginUser"
            class="input"
            placeholder="Username"
            autocomplete="username"
            required
            aria-label="Username"
          />
          <input
            id="loginPass"
            class="input"
            placeholder="Password"
            type="password"
            autocomplete="current-password"
            required
            aria-label="Password"
          />
          <button class="btn primary" type="submit">Login</button>
          <div class="footnote" id="authStatus" role="status" aria-live="polite"></div>
        </form>
      </div>

      <div class="footnote" style="margin-top:10px; text-align:center;">
        Do not paste secrets. Authentication is enforced by the backend.
      </div>
    </div>
  </div>

  <!-- MAIN APPLICATION (hidden until authenticated) -->
  <div id="appShell" class="appLayout hidden">
    <!-- COLLAPSIBLE SIDEBAR -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebarHeader">
        <div class="brand">
          <div class="logo" aria-label="AI Agent Logo">AI</div>
          <div>
            <h1>Infrastructure Troubleshooting</h1>
          </div>
        </div>
        <button class="sidebarToggle" id="sidebarToggle" aria-label="Toggle sidebar">
          <span class="toggleIcon">â—€</span>
        </button>
      </div>

      <div class="sidebarContent">
        <!-- Mode Indicator -->
        <div class="sidebarSection">
          <div class="sectionLabel">Current Mode</div>
          <span class="pill modePill" id="modePill" role="status">Mode: Diagnostics</span>
        </div>

        <!-- Remediation Toggle -->
        <div class="sidebarSection">
          <div class="sectionLabel">Approval</div>
          <label class="toggle" title="Enable only if you approve production-impacting remediation">
            <input type="checkbox" id="approveToggle" aria-label="Remediation approval toggle" />
            <span class="toggleUi" aria-hidden="true"></span>
            <span class="toggleText">Remediation approved</span>
          </label>
        </div>

        <!-- Actions -->
        <div class="sidebarSection">
          <div class="sectionLabel">Actions</div>
          <div class="sidebarButtons">
            <button class="btn secondary fullWidth" type="button" id="clearChatBtn" title="Clear conversation history">
              ğŸ—‘ï¸ Clear Chat
            </button>
            <button class="btn secondary fullWidth" type="button" id="scriptsBtn" title="Upload and manage saved scripts">
              ğŸ“„ Scripts
            </button>
            <button class="btn secondary fullWidth" type="button" id="settingsBtn" title="Configure application settings">
              âš™ï¸ Settings
            </button>
          </div>
        </div>

        <!-- Export Options -->
        <div class="sidebarSection">
          <div class="sectionLabel">Export</div>
          <div class="sidebarButtons">
            <button class="btn secondary fullWidth" type="button" id="copyTicketBtn" title="Copy last response as ticket notes">
              ğŸ“‹ Copy Notes
            </button>
            <button class="btn secondary fullWidth" type="button" id="exportTxtBtn" title="Export conversation as text file">
              ğŸ“ Export TXT
            </button>
            <button class="btn secondary fullWidth" type="button" id="exportJsonBtn" title="Export conversation as JSON">
              ğŸ’¾ Export JSON
            </button>
          </div>
        </div>

        <!-- Logout -->
        <div class="sidebarSection">
          <button class="btn secondary fullWidth logout" type="button" id="logoutBtn" title="Sign out">
            ğŸšª Logout
          </button>
        </div>
      </div>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <main class="mainContent">
      <!-- Top Bar with Presets -->
      <header class="topBar">
        <div class="topBarLeft">
          <button class="mobileMenuBtn" id="mobileMenuBtn" aria-label="Open menu">
            â˜°
          </button>
          <p class="tagline">Diagnostics-first. Approval-gated remediation. Paste logs/scripts or upload screenshots.</p>
        </div>
        <div class="presets" aria-label="Preset intake templates">
          <span class="presetsLabel">Quick Templates:</span>
          <button class="chip" type="button" data-preset="network" title="Network troubleshooting template">
            ğŸŒ Network
          </button>
          <button class="chip" type="button" data-preset="server" title="Server troubleshooting template">
            ğŸ–¥ï¸ Server
          </button>
          <button class="chip" type="button" data-preset="script" title="Script debugging template">
            ğŸ“œ Script
          </button>
          <button class="chip" type="button" data-preset="hardware" title="Hardware diagnostics template">
            ğŸ”§ Hardware
          </button>
        </div>
      </header>

      <!-- Chat Area -->
      <section class="chatSection">
        <div 
          class="chat" 
          id="chat" 
          role="log" 
          aria-label="Chat transcript" 
          aria-live="polite"
        ></div>
      </section>

      <!-- Message Composer -->
      <section class="composerSection">
        <form class="composer" id="form">
          <label class="fileBtn" title="Attach a screenshot (optional, supports image analysis)">
            <input 
              type="file" 
              id="image" 
              accept="image/*" 
              aria-label="Attach screenshot"
            />
            ğŸ“ Screenshot
          </label>

          <textarea
            id="message"
            class="input messageInput"
            rows="3"
            placeholder="Describe the issue or paste logs/errors/scripts... (Ctrl/Cmd + Enter to send)"
            required
            aria-label="Message input"
          ></textarea>

          <button class="btn primary sendBtn" type="submit" id="sendBtn">
            Send â†’
          </button>
        </form>

        <div class="footnote">
          ğŸ’¡ <strong>Tip:</strong> Use Ctrl/Cmd + Enter to send quickly. Do not paste secrets (keys/passwords).
        </div>
      </section>
    </main>

    <!-- Toast Notifications -->
    <div class="toast" id="toast" role="status" aria-live="polite"></div>
  </div>

  <!-- Configuration -->
  <script>
    // Backend configuration
    // For local development, update these URLs:
    // window.BACKEND_URL = "http://localhost:10000/api/chat";
    // window.LOGIN_URL = "http://localhost:10000/auth/login";
    
    window.BACKEND_URL = "https://csrma-agent.onrender.com/api/chat";
    window.LOGIN_URL = "https://csrma-agent.onrender.com/auth/login";
  </script>

  <!-- Application Script -->
  <script src="./app.js?v=5"></script>
</body>
</html>
